# Configuracao do framework topsys.

JNDI.CONNECTION java:comp/env/jdbc/ZapeatSiteDS

CLASS.BROKER.IMPL br.com.topsys.database.jdbc.TSDataBaseBrokerImpl

CLASS.SEQUENCE.IMPL br.com.topsys.database.jdbc.sequence.TSSequencePostgresImpl

CODIGO.UNIQUE 23505

CODIGO.FOREIGNKEY 23503

#ComentarioDAO
comentariodao.obterIndicacaoEstabelecimento=SELECT C.DESCRICAO, F.ID, F.NOME_FANTASIA, F.LOGOMARCA, U.NOME FROM PUBLIC.COMENTARIOS C, PROMOCOES P, FORNECEDORES F, USUARIOS U WHERE C.PROMOCAO_ID = P.ID AND P.FORNECEDOR_ID = F.ID AND C.USUARIO_ID = U.ID AND F.FLAG_ATIVO AND C.FLAG_INDICA_ATENDIMENTO ORDER BY RANDOM() LIMIT 1

#FornecedorDAO
fornecedordao.obter=SELECT ID, RAZAO_SOCIAL, CNPJ, NOME_FANTASIA, CEP, LOGRADOURO, NUMERO, BAIRRO, CIDADE_ID, LATITUDE, LONGITUDE, LOGOMARCA, FLAG_ATIVO, DESCRICAO, HORARIOS_FUNCIONAMENTO, TWITTER, FACEBOOK, SITE, TELEFONE FROM PUBLIC.FORNECEDORES WHERE ID = ? AND FLAG_ATIVO
fornecedordao.pesquisarHome=SELECT ID, LOGOMARCA, NOME_FANTASIA FROM PUBLIC.FORNECEDORES ORDER BY RANDOM() LIMIT 6
fornecedordao.pesquisarTopGeral=SELECT F.ID, F.NOME_FANTASIA, SUM(CASE WHEN C.FLAG_INDICA_ATENDIMENTO THEN 1 ELSE 0 END + CASE WHEN C.FLAG_INDICA_PROMOCAO THEN 1 ELSE 0 END) TOTAL FROM COMENTARIOS C, PROMOCOES P, FORNECEDORES F WHERE C.PROMOCAO_ID = P.ID AND P.FORNECEDOR_ID = F.ID GROUP BY F.ID, F.NOME_FANTASIA ORDER BY TOTAL DESC LIMIT 5

#ImagemFornecedorDAO
imagemfornecedordao.pesquisar=SELECT ID, FORNECEDOR_ID, IMAGEM FROM IMAGENS_FORNECEDORES WHERE FORNECEDOR_ID = ? ORDER BY ID DESC LIMIT 3

#PromocaoDAO
promocaodao.pesquisarporindicacoes=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.TELEFONE, F.SITE, CAT.ID, CAT.DESCRICAO, P.DESCRICAO, P.TITULO, (SELECT COUNT(*) FROM COMENTARIOS C WHERE C.PROMOCAO_ID = P.ID AND C.FLAG_INDICA_PROMOCAO AND C.FLAG_INDICA_ATENDIMENTO) AS INDICACOES FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES F ON P.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID AND FC.PRIORIDADE = 1 ORDER BY INDICACOES DESC LIMIT 4 OFFSET(COALESCE(?, 1) - 1) * 4
promocaodao.pesquisarqtdpaginasporindicacoes=SELECT CASE WHEN MOD(COUNT(*)/4 ,2) > 0 THEN COUNT(*)/4+1 ELSE COUNT(*)/4 END FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES F ON P.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID AND FC.PRIORIDADE = 1
promocaodao.obterPromocaoHora=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 1 AND DATE_TRUNC ('DAY', P.INICIO) >= CURRENT_DATE AND DATE_TRUNC('DAY', P.FIM) <= CURRENT_DATE ORDER BY RANDOM() LIMIT 1
promocaodao.pesquisarPromocoesHora=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 1 AND DATE_TRUNC ('DAY', P.INICIO) >= CURRENT_DATE AND DATE_TRUNC('DAY', P.FIM) <= CURRENT_DATE ORDER BY RANDOM()
promocaodao.obterPromocaoDia=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 2 AND DATE_TRUNC ('DAY', P.INICIO) = CURRENT_DATE AND P.FORNECEDOR_ID = COALESCE(?, P.FORNECEDOR_ID) AND P.FORNECEDOR_ID > 0 ORDER BY RANDOM() LIMIT 1
promocaodao.obterPromocaoSemana=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 3 AND DATE_TRUNC ('DAY', P.INICIO) >= CURRENT_DATE AND DATE_TRUNC('DAY', P.FIM) <= CURRENT_DATE AND P.FORNECEDOR_ID = COALESCE(?, P.FORNECEDOR_ID) AND P.FORNECEDOR_ID > 0 ORDER BY RANDOM() LIMIT 1

#UsuarioDAO
usuariodao.obter=SELECT ID, NOME, EMAIL, SENHA, FLAG_ATIVO, IMAGEM FROM PUBLIC.USUARIOS_SITE WHERE EMAIL = ?

#BuscaDAO
buscadao.pesquisarpromocaoportexto=SELECT DISTINCT P.TITULO, F.RAZAO_SOCIAL, P.DESCRICAO, 2, CAT.DESCRICAO, F.TELEFONE, F.SITE, (SELECT COUNT(*) FROM COMENTARIOS C WHERE C.PROMOCAO_ID = P.ID AND C.FLAG_INDICA_PROMOCAO AND C.FLAG_INDICA_ATENDIMENTO) AS INDICACOES FROM PROMOCOES P INNER JOIN FORNECEDORES F ON F.id = P.FORNECEDOR_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID WHERE F.DESCRICAO ILIKE COALESCE(?, F.DESCRICAO)
buscadao.pesquisarcarrochefeportexto=SELECT DISTINCT CC.TITULO, F.RAZAO_SOCIAL, CC.DESCRICAO, 2, CAT.DESCRICAO, F.TELEFONE, F.SITE FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON F.ID = CC.FORNECEDOR_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID WHERE CC.DESCRICAO ILIKE COALESCE(?, CC.DESCRICAO)
buscadao.pesquisarestabelecimentoportexto=SELECT DISTINCT F.RAZAO_SOCIAL, F.LOGRADOURO || ', ' || F.BAIRRO, F.DESCRICAO, 1, CAT.DESCRICAO, F.TELEFONE, F.SITE, (SELECT COUNT(*) FROM COMENTARIOS C WHERE C.PROMOCAO_ID = P.ID AND C.FLAG_INDICA_PROMOCAO AND C.FLAG_INDICA_ATENDIMENTO) AS INDICACOES FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID AND FC.PRIORIDADE = 1 LEFT OUTER JOIN PROMOCOES P ON P.FORNECEDOR_ID = F.ID WHERE F.DESCRICAO ILIKE COALESCE(?, F.DESCRICAO)

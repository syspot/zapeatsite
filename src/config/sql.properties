# Configuracao do framework topsys.

JNDI.CONNECTION java:comp/env/jdbc/ZapeatSiteDS

CLASS.BROKER.IMPL br.com.topsys.database.jdbc.TSDataBaseBrokerImpl

CLASS.SEQUENCE.IMPL br.com.topsys.database.jdbc.sequence.TSSequencePostgresImpl

CODIGO.UNIQUE 23505

CODIGO.FOREIGNKEY 23503

CODIGO.RAISE.EXCEPTION 09000

#ComentarioDAO
comentariodao.inserir=INSERT INTO PUBLIC.INDICACOES (USUARIO_ID, FORNECEDOR_ID, DESCRICAO, DATA_CADASTRO, FLAG_INDICA, FLAG_NAO_INDICA) VALUES (?, ?, ?, CURRENT_TIMESTAMP, ?, ?)
comentariodao.obterIndicacaoEstabelecimento=SELECT C.ID, C.DESCRICAO, US.NOME, F.ID, F.NOME_FANTASIA, (SELECT IMAGEM FROM IMAGENS_FORNECEDORES IF WHERE IF.FORNECEDOR_ID = F.ID ORDER BY RANDOM() LIMIT 1) FROM INDICACOES C, USUARIOS_SITE US, FORNECEDORES F WHERE C.USUARIO_ID = US.ID AND C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA AND F.FLAG_ATIVO AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1
comentariodao.obterIndicacaoEstabelecimentoById=SELECT C.ID, C.DESCRICAO, US.NOME, F.ID, F.NOME_FANTASIA, (SELECT IMAGEM FROM IMAGENS_FORNECEDORES IF WHERE IF.FORNECEDOR_ID = F.ID ORDER BY RANDOM() LIMIT 1) FROM INDICACOES C, USUARIOS_SITE US, FORNECEDORES F WHERE C.USUARIO_ID = US.ID AND C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA AND F.FLAG_ATIVO AND F.ID = ? AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1
comentariodao.rankingEstabelecimento=SELECT POSICAO_RANK, ID, NOME_FANTASIA, LOGOMARCA FROM (SELECT RANK() OVER (ORDER BY TOTAL DESC, ID) AS POSICAO_RANK, * FROM (SELECT F.ID, F.NOME_FANTASIA, F.LOGOMARCA, (SELECT COUNT(*) FROM INDICACOES COM WHERE COM.FORNECEDOR_ID \= F.ID AND COM.FLAG_INDICA) AS TOTAL FROM FORNECEDORES F) AS QUERY) AS QUERY2 WHERE ID \= ?
comentariodao.obterindicacao=SELECT C.ID, C.DESCRICAO, US.ID, US.NOME, F.ID, F.NOME_FANTASIA, F.LOGOMARCA FROM INDICACOES C, USUARIOS_SITE US, FORNECEDORES F WHERE C.USUARIO_ID = US.ID AND C.FORNECEDOR_ID = F.ID AND F.ID = ? AND C.USUARIO_ID = ? ORDER BY RANDOM() LIMIT 1
comentariodao.obterIndicacaoComidaNegativa=SELECT C.ID, C.DESCRICAO, US.ID, US.NOME, F.ID, F.NOME_FANTASIA, F.LOGOMARCA FROM INDICACOES C, USUARIOS_SITE US, FORNECEDORES F WHERE C.USUARIO_ID = US.ID AND C.FORNECEDOR_ID = F.ID AND C.FLAG_NAO_INDICA_COMIDA AND F.ID = ? AND C.USUARIO_ID = ? ORDER BY RANDOM() LIMIT 1
comentariodao.obterIndicacaoEstabelecimentoPorUsuario=SELECT C.ID, C.DESCRICAO, US.ID, US.NOME, F.ID, F.NOME_FANTASIA, F.LOGOMARCA FROM INDICACOES C, USUARIOS_SITE US, FORNECEDORES F WHERE C.USUARIO_ID = US.ID AND C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA AND F.ID = ? AND C.USUARIO_ID = ? ORDER BY RANDOM() LIMIT 1
comentariodao.pesquisarcomentariospromocao=SELECT C.ID, C.DESCRICAO, C.DATA_CADASTRO, C.PROMOCAO_ID, C.USUARIO_ID, U.NOME FROM COMENTARIOS_PROMOCOES C INNER JOIN USUARIOS_SITE U ON C.USUARIO_ID = U.ID WHERE PROMOCAO_ID = ?
comentariodao.pesquisarcomentariosfornecedor=SELECT C.ID, C.DESCRICAO, C.DATA_CADASTRO, C.FORNECEDOR_ID, C.USUARIO_ID, U.NOME FROM COMENTARIOS_FORNECEDORES C INNER JOIN USUARIOS_SITE U ON C.USUARIO_ID = U.ID WHERE FORNECEDOR_ID = ?
comentariodao.pesquisarcomentarioscarrochefe=SELECT C.ID, C.DESCRICAO, C.DATA_CADASTRO, C.CARRO_CHEFE_ID, C.USUARIO_ID, U.NOME FROM COMENTARIOS_CARROS_CHEFES C INNER JOIN USUARIOS_SITE U ON C.USUARIO_ID = U.ID WHERE CARRO_CHEFE_ID = ?
comentariodao.comentarpromocao=INSERT INTO COMENTARIOS_PROMOCOES (DESCRICAO, PROMOCAO_ID, USUARIO_ID) VALUES (?, ?, ?)
comentariodao.comentarfornecedor=INSERT INTO COMENTARIOS_FORNECEDORES (DESCRICAO, FORNECEDOR_ID, USUARIO_ID) VALUES (?, ?, ?)
comentariodao.comentarcarrochefe=INSERT INTO COMENTARIOS_CARROS_CHEFES (DESCRICAO, CARRO_CHEFE_ID, USUARIO_ID) VALUES (?, ?, ?)

#FornecedorDAO
fornecedordao.obter=SELECT F.ID, F.RAZAO_SOCIAL, F.CNPJ, F.NOME_FANTASIA, F.CEP, F.LOGRADOURO, F.NUMERO, F.BAIRRO, F.CIDADE_ID, F.LATITUDE, F.LONGITUDE, F.LOGOMARCA, F.FLAG_ATIVO, F.DESCRICAO, F.HORARIOS_FUNCIONAMENTO, F.TWITTER, F.FACEBOOK, F.SITE, F.TELEFONE, (SELECT COUNT(*) FROM INDICACOES COM WHERE COM.FORNECEDOR_ID = F.ID AND COM.FLAG_INDICA) AS QTD_INDICA, (SELECT IMAGEM FROM IMAGENS_FORNECEDORES IF WHERE IF.FORNECEDOR_ID = F.ID ORDER BY RANDOM() LIMIT 1), CAT.ID, CAT.DESCRICAO, CAT.IMAGEM FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID AND FC.PRIORIDADE = 1 WHERE F.ID = ? AND F.FLAG_ATIVO
fornecedordao.pesquisarHome=SELECT ID, LOGOMARCA, NOME_FANTASIA FROM PUBLIC.FORNECEDORES WHERE CIDADE_ID = COALESCE(?, CIDADE_ID) AND FLAG_ATIVO ORDER BY RANDOM() LIMIT 6
fornecedordao.pesquisarTopGeral=SELECT F.ID, F.NOME_FANTASIA, SUM(CASE WHEN FLAG_INDICA THEN 1 ELSE 0 END) TOTAL FROM PUBLIC.INDICACOES C, FORNECEDORES F WHERE C.FORNECEDOR_ID \= F.ID AND CIDADE_ID = COALESCE(?, CIDADE_ID) AND F.FLAG_ATIVO GROUP BY F.ID, F.NOME_FANTASIA ORDER BY TOTAL DESC, F.ID LIMIT 5
fornecedordao.pesquisartop10=SELECT F.ID, F.NOME_FANTASIA, (SELECT COUNT(*) FROM INDICACOES COM WHERE COM.FORNECEDOR_ID = F.ID AND COM.FLAG_INDICA) AS TOTAL, (SELECT IMAGEM FROM IMAGENS_FORNECEDORES IF WHERE IF.FORNECEDOR_ID = F.ID ORDER BY RANDOM() LIMIT 1), CAT.ID, CAT.DESCRICAO FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON F.ID = FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE F.FLAG_ATIVO AND CAT.ID = ? AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY TOTAL DESC, F.NOME_FANTASIA ASC LIMIT 10
fornecedordao.pesquisarMelhorComida=SELECT F.ID, F.NOME_FANTASIA, (SELECT COUNT(*) FROM INDICACOES COM WHERE COM.FORNECEDOR_ID \= F.ID AND FLAG_INDICA) AS TOTAL, (SELECT IMAGEM FROM IMAGENS_FORNECEDORES IF WHERE IF.FORNECEDOR_ID \= F.ID ORDER BY RANDOM() LIMIT 1) AS IMAGEM, CAT.ID, CAT.DESCRICAO FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON F.ID \= FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID \= FC.CATEGORIA_ID WHERE F.FLAG_ATIVO AND CAT.ID \= ? ORDER BY TOTAL DESC, F.ID LIMIT 5
fornecedordao.pesquisarporcategoria=SELECT DISTINCT F.ID, F.LOGOMARCA, F.NOME_FANTASIA, F.DESCRICAO, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA) AS INDICACOES, row_number() over() FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE CAT.ID = COALESCE(?, CAT.ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY NOME_FANTASIA LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
fornecedordao.obterqtdpaginasporcategoria=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE CAT.ID = COALESCE(?, CAT.ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)
fornecedordao.pesquisaporcategoriamaisindicadas=SELECT DISTINCT F.ID, F.LOGOMARCA, F.NOME_FANTASIA, F.DESCRICAO, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID \= F.ID AND C.FLAG_INDICA) AS INDICACOES, row_number() over() FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID \= F.ID AND PRIORIDADE \= 1 INNER JOIN CATEGORIAS CAT ON CAT.ID \= FC.CATEGORIA_ID WHERE F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY INDICACOES DESC, F.ID LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
fornecedordao.pesquisaporcategoriaoutrascategorias=SELECT DISTINCT F.ID, F.LOGOMARCA, F.NOME_FANTASIA, F.DESCRICAO, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID \= F.ID AND C.FLAG_INDICA) AS INDICACOES, row_number() over() FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID \= F.ID AND PRIORIDADE \= 1 INNER JOIN CATEGORIAS CAT ON CAT.ID \= FC.CATEGORIA_ID ORDER BY INDICACOES DESC, F.ID LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
fornecedordao.pesquisarqtdpaginasporcategoriamaisindicados=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)
fornecedordao.pesquisarqtdpaginasporcategoriaoutrascategorias=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID

#ImagemFornecedorDAO
imagemfornecedordao.pesquisar=SELECT ID, FORNECEDOR_ID, IMAGEM FROM IMAGENS_FORNECEDORES WHERE FORNECEDOR_ID = ? ORDER BY RANDOM() LIMIT 3

#ImagemPromocaoDAO
imagempromocaodao.pesquisar=SELECT ID, PROMOCAO_ID, IMAGEM FROM IMAGENS_PROMOCOES WHERE PROMOCAO_ID = ?  ORDER BY RANDOM()

#ImagemCarroChefeDAO
imagemcarrochefedao.pesquisar=SELECT ID, CARRO_CHEFE_ID, IMAGEM FROM IMAGENS_CARROS_CHEFES WHERE CARRO_CHEFE_ID = ? ORDER BY RANDOM() 

#PromocaoDAO
promocaodao.pesquisarporindicacoes=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, P.DESCRICAO, P.TITULO, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA) AS INDICACOES, row_number() over() FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.ID = P.FORNECEDOR_CATEGORIA_ID INNER JOIN FORNECEDORES F ON F.ID = FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE TP.ID = COALESCE(?, TP.ID) AND FC.CATEGORIA_ID = COALESCE(?, FC.CATEGORIA_ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY P.TITULO DESC LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
promocaodao.pesquisarporindicacoesmaisindicados=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, P.DESCRICAO, P.TITULO, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA) AS INDICACOES, row_number() over() FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.ID = P.FORNECEDOR_CATEGORIA_ID INNER JOIN FORNECEDORES F ON F.ID = FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE TP.ID = COALESCE(?, TP.ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY INDICACOES DESC LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
promocaodao.pesquisarqtdpaginasporindicacoes=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.ID = P.FORNECEDOR_CATEGORIA_ID INNER JOIN FORNECEDORES F ON F.ID = FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE TP.ID = COALESCE(?, TP.ID) AND FC.CATEGORIA_ID = COALESCE(?, FC.CATEGORIA_ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)
promocaodao.pesquisarqtdpaginasporindicacoesmaisindicados=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.ID = P.FORNECEDOR_CATEGORIA_ID INNER JOIN FORNECEDORES F ON F.ID = FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE TP.ID = COALESCE(?, TP.ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)
promocaodao.obterPromocaoHora=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, FC.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, F.LONGITUDE, F.LATITUDE, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), F.LOGOMARCA FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F, FORNECEDORES_CATEGORIAS FC WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_CATEGORIA_ID = FC.ID AND FC.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 1 AND CURRENT_TIMESTAMP BETWEEN P.INICIO AND P.FIM AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1
promocaodao.pesquisarPromocoesHora=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, FC.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, F.LONGITUDE, F.LATITUDE, F.SITE, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA) AS INDICACOES, F.TELEFONE, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1) FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F, FORNECEDORES_CATEGORIAS FC WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_CATEGORIA_ID = FC.ID AND FC.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 1 AND CURRENT_TIMESTAMP BETWEEN P.INICIO AND P.FIM AND P.ID <> ? AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 6
promocaodao.obterpromocaohoraaleatoria=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, F.ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), F.LONGITUDE, F.LATITUDE FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON P.TIPO_PROMOCAO_ID = TP.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON P.FORNECEDOR_CATEGORIA_ID = FC.ID INNER JOIN FORNECEDORES F ON FC.FORNECEDOR_ID = F.ID WHERE TP.ID = 1 AND CURRENT_TIMESTAMP BETWEEN P.INICIO AND P.FIM AND F.ID = COALESCE(?, F.ID) AND P.ID <> COALESCE(?, 0) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1
promocaodao.obterPromocaoDia=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, F.ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), F.LONGITUDE, F.LATITUDE FROM PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES_CATEGORIAS FC, FORNECEDORES F WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_CATEGORIA_ID = FC.ID AND FC.FORNECEDOR_ID = F.ID AND P.TIPO_PROMOCAO_ID = 2 AND DATE_TRUNC ('DAY', P.INICIO) = CURRENT_DATE AND FC.FORNECEDOR_ID = COALESCE(?, FC.FORNECEDOR_ID) AND FC.FORNECEDOR_ID > 0 ORDER BY RANDOM() LIMIT 1
promocaodao.obterpromocaodiaaleatoria=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, F.ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), F.LONGITUDE, F.LATITUDE FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON P.TIPO_PROMOCAO_ID = TP.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON P.FORNECEDOR_CATEGORIA_ID = FC.ID INNER JOIN FORNECEDORES F ON FC.FORNECEDOR_ID = F.ID WHERE TP.ID = 2 AND CURRENT_TIMESTAMP BETWEEN P.INICIO AND P.FIM AND F.ID = COALESCE(?, F.ID) AND P.ID <> COALESCE(?, 0) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1
promocaodao.obterPromocaoSemana=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, FC.FORNECEDOR_ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), F.LONGITUDE, F.LATITUDE FROM      PUBLIC.PROMOCOES P, TIPOS_PROMOCOES TP, FORNECEDORES F, FORNECEDORES_CATEGORIAS FC WHERE P.TIPO_PROMOCAO_ID = TP.ID AND P.FORNECEDOR_CATEGORIA_ID = FC.ID AND FC.FORNECEDOR_ID = F.ID     AND P.TIPO_PROMOCAO_ID = 3 AND CURRENT_DATE BETWEEN DATE_TRUNC ('DAY', P.INICIO) AND DATE_TRUNC('DAY', P.FIM) AND FC.FORNECEDOR_ID = COALESCE(?, FC.FORNECEDOR_ID) AND FC.FORNECEDOR_ID > 0 ORDER BY RANDOM() LIMIT 1
promocaodao.obterpromocaosemanaaleatoria=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, F.ID, F.NOME_FANTASIA, P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), F.LONGITUDE, F.LATITUDE FROM PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON P.TIPO_PROMOCAO_ID = TP.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON P.FORNECEDOR_CATEGORIA_ID = FC.ID INNER JOIN FORNECEDORES F ON FC.FORNECEDOR_ID = F.ID WHERE TP.ID = 3 AND CURRENT_TIMESTAMP BETWEEN P.INICIO AND P.FIM AND F.ID = COALESCE(?, F.ID) AND P.ID <> COALESCE(?, 0) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1
promocaodao.obter=SELECT P.ID, P.TIPO_PROMOCAO_ID, TP.DESCRICAO, P.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.HORARIOS_FUNCIONAMENTO, F.LOGRADOURO, F.NUMERO, F.BAIRRO, F.TELEFONE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, (SELECT IMAGEM FROM IMAGENS_PROMOCOES IP WHERE IP.PROMOCAO_ID = P.ID ORDER BY RANDOM() LIMIT 1), P.DESCRICAO, P.INICIO, P.FIM, P.PRECO_ORIGINAL, P.PRECO_PROMOCIONAL, P.TITULO, F.LONGITUDE, F.LATITUDE FROM PUBLIC.PROMOCOES P INNER JOIN TIPOS_PROMOCOES TP ON TP.ID = P.TIPO_PROMOCAO_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.ID = P.FORNECEDOR_CATEGORIA_ID INNER JOIN FORNECEDORES F ON F.ID = FC.FORNECEDOR_ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE P.ID = ? AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)

#UsuarioDAO
usuariodao.inserir=INSERT INTO PUBLIC.USUARIOS_SITE (ID, NOME, EMAIL, SENHA, FLAG_ATIVO, IMAGEM, TOKEN, FLAG_FACEBOOK) VALUES (?, ?, ?, ?, ?, ?, ?, ?)
usuariodao.obter=SELECT ID, NOME, EMAIL, SENHA, FLAG_ATIVO, IMAGEM FROM PUBLIC.USUARIOS_SITE WHERE EMAIL = ?
usuariodao.getById=SELECT ID, NOME, EMAIL, SENHA, FLAG_ATIVO, IMAGEM FROM PUBLIC.USUARIOS_SITE WHERE ID = ?
usuariodao.alterar=UPDATE PUBLIC.USUARIOS_SITE SET NOME = ? WHERE ID = ?
usuariodao.alterarStatus=UPDATE PUBLIC.USUARIOS_SITE SET FLAG_ATIVO = ? WHERE ID = ?

#BuscaDAO
buscadao.pesquisarportexto=SELECT row_number() over(), * FROM FC_BUSCAR(?, ?) LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
buscadao.obterqtdpaginasportexto=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM FC_BUSCAR(?, ?)
buscadao.pesquisarpromocaoportexto=SELECT DISTINCT P.TITULO, F.RAZAO_SOCIAL, P.DESCRICAO, 2, CAT.DESCRICAO, F.TELEFONE, F.SITE, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = P.ID AND C.FLAG_INDICA) AS INDICACOES FROM PROMOCOES P INNER JOIN FORNECEDORES F ON F.id = P.FORNECEDOR_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID WHERE F.DESCRICAO ILIKE COALESCE(?, F.DESCRICAO)
buscadao.pesquisarcarrochefeportexto=SELECT DISTINCT CC.TITULO, F.RAZAO_SOCIAL, CC.DESCRICAO, 2, CAT.DESCRICAO, F.TELEFONE, F.SITE FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON F.ID = CC.FORNECEDOR_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID WHERE CC.DESCRICAO ILIKE COALESCE(?, CC.DESCRICAO)
buscadao.pesquisarestabelecimentoportexto=SELECT DISTINCT F.RAZAO_SOCIAL, F.LOGRADOURO || ', ' || F.BAIRRO, F.DESCRICAO, 1, CAT.DESCRICAO, F.TELEFONE, F.SITE, (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = P.ID AND C.FLAG_INDICA) AS INDICACOES FROM FORNECEDORES F INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID LEFT OUTER JOIN PROMOCOES P ON P.FORNECEDOR_ID = F.ID WHERE F.DESCRICAO ILIKE COALESCE(?, F.DESCRICAO)

#CidadeDAO
cidadedao.obterporcidadeestado=SELECT C.ID, C.NOME, E.ID, E.SIGLA FROM CIDADES C INNER JOIN ESTADOS E ON C.ESTADO_ID = E.ID WHERE UPPER(C.NOME) = UPPER(?) AND UPPER(E.SIGLA) = UPPER(?) LIMIT 1 
cidadedao.pesquisartodos=SELECT C.ID, C.NOME, E.ID, E.SIGLA FROM CIDADES C INNER JOIN ESTADOS E ON C.ESTADO_ID = E.ID ORDER BY C.NOME
cidadedao.obter=SELECT C.ID, C.NOME, E.ID, E.SIGLA FROM CIDADES C INNER JOIN ESTADOS E ON C.ESTADO_ID = E.ID WHERE C.ID = ?

#CarroChefeDAO
carrochefedao.pesquisaporcategoria=SELECT CC.ID, CC.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, CC.DESCRICAO, CC.TITULO, row_number() over() FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE FC.CATEGORIA_ID = COALESCE(?, FC.CATEGORIA_ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY CC.TITULO LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
carrochefedao.pesquisaporcategoriamaisindicados=SELECT CC.ID, CC.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, CC.DESCRICAO, CC.TITULO, row_number() over(), (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA) AS INDICACOES FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY INDICACOES DESC LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
carrochefedao.pesquisaporcategoriaoutrascategorias=SELECT CC.ID, CC.FORNECEDOR_ID, F.NOME_FANTASIA, F.LOGOMARCA, F.TELEFONE, F.SITE, F.LATITUDE, F.LONGITUDE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, CC.DESCRICAO, CC.TITULO, row_number() over(), (SELECT COUNT(*) FROM INDICACOES C WHERE C.FORNECEDOR_ID = F.ID AND C.FLAG_INDICA) AS INDICACOES FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID AND NOT CAT.FLAG_DESTAQUE ORDER BY INDICACOES DESC LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
carrochefedao.pesquisarqtdpaginasporcategoria=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE FC.CATEGORIA_ID = COALESCE(?, FC.CATEGORIA_ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)
carrochefedao.pesquisarqtdpaginasporcategoriamaisindicados=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE F.CIDADE_ID = COALESCE(?, F.CIDADE_ID)
carrochefedao.pesquisarqtdpaginasporcategoriaoutrascategorias=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID AND NOT CAT.FLAG_DESTAQUE
carrochefedao.obter=SELECT CC.ID, F.ID, F.NOME_FANTASIA, F.LOGOMARCA, F.HORARIOS_FUNCIONAMENTO, F.LOGRADOURO, F.NUMERO, F.BAIRRO, F.TELEFONE, CAT.ID, CAT.DESCRICAO, CAT.IMAGEM, (SELECT IMAGEM FROM IMAGENS_CARROS_CHEFES ICC WHERE ICC.CARRO_CHEFE_ID = CC.ID ORDER BY RANDOM() LIMIT 1), CC.DESCRICAO, CC.TITULO, F.LONGITUDE, F.LATITUDE FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON F.ID = CC.FORNECEDOR_ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON CAT.ID = FC.CATEGORIA_ID WHERE CC.ID = ? AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) 
carrochefedao.obterPorFornecedor=SELECT CC.ID, F.ID, F.NOME_FANTASIA, F.LOGOMARCA, F.HORARIOS_FUNCIONAMENTO, F.LOGRADOURO, F.NUMERO, F.BAIRRO, F.TELEFONE, (SELECT IMAGEM FROM IMAGENS_CARROS_CHEFES ICC WHERE ICC.CARRO_CHEFE_ID = CC.ID ORDER BY RANDOM() LIMIT 1), CC.DESCRICAO, CC.TITULO, F.LONGITUDE, F.LATITUDE FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON F.ID = CC.FORNECEDOR_ID WHERE F.ID = ?
carrochefedao.obtercarrochefealeatorio=SELECT CC.ID, CC.FORNECEDOR_ID, F.NOME_FANTASIA, (SELECT COUNT(ID) FROM INDICACOES COM WHERE COM.FORNECEDOR_ID = F.ID AND COM.FLAG_INDICA) AS INDICACOES, CC.DESCRICAO, CC.FLAG_ATIVO, CC.TITULO, (SELECT I.IMAGEM FROM IMAGENS_CARROS_CHEFES I WHERE I.CARRO_CHEFE_ID = CC.ID ORDER BY RANDOM() DESC LIMIT 1) AS IMAGEM_CARRO_CHEFE, CAT.ID, CAT.DESCRICAO FROM CARROS_CHEFES CC INNER JOIN FORNECEDORES F ON CC.FORNECEDOR_ID = F.ID INNER JOIN FORNECEDORES_CATEGORIAS FC ON FC.FORNECEDOR_ID = F.ID AND FC.PRIORIDADE = 1 INNER JOIN CATEGORIAS CAT ON FC.CATEGORIA_ID = CAT.ID AND CC.FLAG_ATIVO WHERE F.ID = COALESCE(?, F.ID) AND F.CIDADE_ID = COALESCE(?, F.CIDADE_ID) ORDER BY RANDOM() LIMIT 1  

#CategoriaDAO
categoriadao.obter=SELECT ID, DESCRICAO, IMAGEM FROM CATEGORIAS WHERE ID = ?
categoriadao.pesquisar=SELECT ID, DESCRICAO, FLAG_ATIVO, IMAGEM, FLAG_DESTAQUE FROM PUBLIC.CATEGORIAS WHERE FLAG_ATIVO AND FLAG_DESTAQUE ORDER BY FLAG_DESTAQUE DESC, DESCRICAO LIMIT 6
categoriadao.pesquisaroutrascategorias=SELECT ID, DESCRICAO, FLAG_ATIVO, IMAGEM, FLAG_DESTAQUE FROM CATEGORIAS WHERE FLAG_ATIVO AND ID NOT IN (SELECT ID FROM CATEGORIAS WHERE FLAG_ATIVO AND FLAG_DESTAQUE ORDER BY DESCRICAO LIMIT 6) ORDER BY DESCRICAO LIMIT 6 OFFSET(COALESCE(?, 1) - 1) * 6
categoriadao.obterqtdpaginasoutrascategorias=SELECT CASE WHEN MOD(COUNT(*) ,6) > 0 THEN COUNT(*)/6+1 ELSE COUNT(*)/6 END FROM PUBLIC.CATEGORIAS WHERE FLAG_ATIVO AND NOT FLAG_DESTAQUE

#BannerDAO
bannerdao.obterbannertopo=SELECT B.ID, B.IMAGEM, B.URL FROM BANNERS B WHERE B.FLAG_ATIVO AND B.TIPO_BANNER_ID = 1 AND CURRENT_DATE BETWEEN B.INICIO AND B.FIM ORDER BY B.TAXA_PRIORIDADE ASC, RANDOM() LIMIT 1
bannerdao.obterbannerlateral=SELECT B.ID, B.IMAGEM, B.URL FROM BANNERS B WHERE B.FLAG_ATIVO AND B.TIPO_BANNER_ID = 2 AND CURRENT_DATE BETWEEN B.INICIO AND B.FIM ORDER BY B.TAXA_PRIORIDADE ASC, RANDOM() LIMIT 1

#FormaPagaamentoDAO
formapagamentodao.pesquisar=SELECT FP.ID, FP.DESCRICAO, FP.IMAGEM FROM FORMAS_PAGAMENTOS FP INNER JOIN FORNECEDORES_FORMAS_PAGAMENTOS FFP ON FP.ID = FFP.FORMA_PAGAMENTO_ID WHERE FFP.FORNECEDOR_ID = ?

